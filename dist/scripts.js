!function(t){var e={};function r(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);class i{constructor(t){this.height=t.length,this.width=t[0].length,this.data=new Array(this.height),this.flipData=new Array(this.height),this.spinDataArrays=new Array,this.flipDataArrays=new Array,this.allDataArrays=new Array,this.area=0;for(let e=0;e<this.height;e++){this.data[e]=new Array(this.width),this.flipData[e]=new Array(this.width);for(let r=0;r<this.width;r++)this.data[e][r]=t[e][r],this.flipData[e][this.width-1-r]=t[e][r]," "!=t[e][r]&&this.area++}this.spinDataArrays.push(this.data.slice(0)),this.spinDataArrays.push(this.generateRotate90(this.data)),this.spinDataArrays.push(this.generateRotate180(this.data)),this.spinDataArrays.push(this.generateRotate270(this.data)),this.flipDataArrays.push(this.flipData.slice(0)),this.flipDataArrays.push(this.generateRotate90(this.flipData)),this.spinDataArrays.push(this.generateRotate180(this.flipData)),this.spinDataArrays.push(this.generateRotate270(this.flipData));for(let t=0;t<this.spinDataArrays.length;t++)for(let e=t+1;e<this.spinDataArrays.length;e++)this.equalData(this.spinDataArrays[t],this.spinDataArrays[e])&&(this.spinDataArrays.splice(e,1),e--);for(let t=0;t<this.flipDataArrays.length;t++)for(let e=t+1;e<this.flipDataArrays.length;e++)this.equalData(this.flipDataArrays[t],this.flipDataArrays[e])&&(this.flipDataArrays.splice(e,1),e--);for(let t=0;t<this.flipDataArrays.length;t++)this.allDataArrays.push(this.flipDataArrays[t]);for(let t=0;t<this.spinDataArrays.length;t++)this.allDataArrays.push(this.spinDataArrays[t]);for(let t=0;t<this.allDataArrays.length;t++)for(let e=t+1;e<this.allDataArrays.length;e++)this.equalData(this.allDataArrays[t],this.allDataArrays[e])&&(this.allDataArrays.splice(e,1),e--)}getArea(){return this.area}equal(t){if(t.area!=this.area)return!1;if(t.dat.length!=this.data.length)return!1;for(let e=0;e<this.data.length;e++)if(!this.arraysEqual(data[e],t.data[e]))return!1;return!0}equalData(t,e){if(t.length!=e.length||t[0].length!=e[0].length)return!1;for(let r=0;r<t.length;r++)if(!this.arraysEqual(t[r],e[r]))return!1;return!0}equalSpin(t){if(t.area!=this.area)return!1;for(let e=0;e<this.spinDataArrays.length;e++)if(this.equalData(spinDataArrays[e],t.spinDataArrays[0]))return!0;return!1}equalFlip(t){if(t.area!=this.area)return!1;for(let e=0;e<this.flipDataArrays.length;e++)if(this.equalData(flipDataArrays[e],t.flipDataArrays[0]))return!0;return!1}arraysEqual(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}generateRotate90(t){let e=[];for(let t=0;t<this.width;t++)e.push(new Array(this.height));for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++)e[i][this.height-r-1]=t[r][i];return e}generateRotate180(t){let e=[];for(let r=0;r<this.height;r++){e.push(new Array(this.width));for(let i=0;i<this.width;i++)e[r][i]=t[this.height-r-1][this.width-i-1]}return e}generateRotate270(t){let e=[];for(let t=0;t<this.width;t++)e.push(new Array(this.height));for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++)e[this.width-i-1][r]=t[r][i];return e}}class s{constructor(t){this.fileContent=[],this.leftMost=Number.MAX_SAFE_INTEGER,this.upMost=Number.MAX_SAFE_INTEGER,this.rightMost=Number.MIN_SAFE_INTEGER,this.downMost=Number.MIN_SAFE_INTEGER,this.tiles=[],this.board=null,console.log(t);var e=t.split(/\r?\n/),r=0;for(let t=0;t<e.length;t++)e[t].length>r&&(r=e[t].length);for(let t=0;t<e.length;t++)e[t]=e[t]+" ".repeat(r-e[t].length);console.log(e);for(let t=0;t<e.length;t++){this.fileContent.push(new Array(r));for(let i=0;i<r;i++)this.fileContent[t][i]=e[t].charAt(i)}let s=e.length,l=r,h=[];for(var a=0;a<9;a++){h[a]=[];for(var n=0;n<9;n++)h[a][n]=!1}for(let t=0;t<s;t++)h.push(new Array(l));console.log(this.fileContent);for(let t=0;t<s;t++)for(let e=0;e<l;e++)if(" "!=this.fileContent[t][e]){if(!h[t][e]){this.find(this.fileContent,h,t,e);let r=this.rightMost-this.leftMost+1,s=this.downMost-this.upMost+1,l=[];for(let t=0;t<s;t++){l.push(new Array(r));for(let e=0;e<r;e++)l[t][e]=this.fileContent[this.upMost+t][this.leftMost+e]}console.log(l);var o=new i(l);this.tiles.push(o),this.leftMost=Number.MAX_SAFE_INTEGER,this.upMost=Number.MAX_SAFE_INTEGER,this.rightMost=Number.MIN_SAFE_INTEGER,this.downMost=Number.MIN_SAFE_INTEGER}}else h[t][e]=!0;let u=0,f=0;for(let t=0;t<this.tiles.length;t++)this.tiles[t].getArea()>f&&(f=this.tiles[t].getArea(),u=t);this.board=this.tiles[u],this.tiles.splice(u,1),console.log("tiles:");for(let t=0;t<this.tiles.length;t++)console.log(this.tiles[t].allDataArrays)}find(t,e,r,i){r<0||i<0||r>=t.length||i>=t[0].length||e[r][i]||" "!=t[r][i]&&(i>this.rightMost&&(this.rightMost=i),i<this.leftMost&&(this.leftMost=i),r>this.downMost&&(this.downMost=r),r<this.upMost&&(this.upMost=r),e[r][i]=!0,this.find(t,e,r-1,i),this.find(t,e,r+1,i),this.find(t,e,r,i-1),this.find(t,e,r,i+1))}getTiles(){return this.tiles}getBoard(){return this.board}}class l{constructor(t,e,r,i){let s=new Array;this.tileNum=t.length,this.columnNum=e.area+t.length,this.boardidx=new Array,this.buildBoardIdxArray(e);for(let l=0;l<t.length;l++){let h=t[l];if(i)for(let r=0;r<h.allDataArrays.length;r++)this.check(h.allDataArrays[r],e.data,s,l,t.length);else if(r)for(let r=0;r<h.spinDataArrays.length;r++)this.check(h.spinDataArrays[r],e.data,s,t.length);else this.check(h.data,e.data,s,l,t.length)}this.coverArray=[];for(let t=0;t<s.length;t++){let e=s[t];this.coverArray.push(new Array(s[0].length)),this.coverArray[t].fill(0);for(let r=0;r<e.length;r++)1==e[r]&&(this.coverArray[t][r]=1)}console.log(this.coverArray),this.rowNum=this.coverArray.length}buildBoardIdxArray(t){let e=0;for(let e=0;e<t.data.length;e++)this.boardidx.push(new Array(t.data[0].length));for(let r=0;r<t.data.length;r++)for(let i=0;i<t.data[0].length;i++)" "!=t.data[r][i]?this.boardidx[r][i]=e++:this.boardidx[r][i]=-1}check(t,e,r,i,s){let l=t.length,h=e.length,a=t[0].length,n=e[0].length;for(let o=0;o<h-l+1;o++)for(let h=0;h<n-a+1;h++)if(this.isValid(t,e,o,h)){let e=new Array(this.columnNum);e.fill(0),e[i]=1;for(let r=0;r<l;r++)for(let i=0;i<a;i++)" "!=t[r][i]&&(e[s+this.boardidx[o+r][h+i]]=1);r.push(e)}}isValid(t,e,r,i){let s=t.length,l=t[0].length;for(let h=0;h<s;h++)for(let s=0;s<l;s++)if(" "!=t[h][s]&&e[r+h][i+s]!=t[h][s])return!1;return!0}}class h{constructor(){this.left=null,this.right=null,this.up=null,this.down=null,this.row=null,this.col=null,this.head=null}}class a extends h{constructor(){super(),this.size=0,this.left=null,this.right=null,this.name=null,this.id=null}}class n{constructor(t){this.coverArray=t.coverArray,this.tileNum=t.tileNum,this.columnNodes=[],this.nodes=[];for(let e=0;e<t.rowNum;e++)this.nodes.push(new Array(t.columnNum));this.h=new a;for(let e=0;e<t.columnNum;e++){let r=new a;r.down=r,r.up=r,r.row=-1,r.col=e,0==e?(r.left=this.h,this.h.right=r):e!=t.columnNum-1?(r.left=this.columnNodes[e-1],this.columnNodes[e-1].right=r):(this.columnNodes[e-1].right=r,r.left=this.columnNodes[e-1],r.right=this.h,this.h.left=r),this.columnNodes.push(r)}for(let e=0;e<t.columnNum;e++){let r=0;for(let i=0;i<t.rowNum;i++)if(1==t.coverArray[i][e]){let t=new h;this.nodes[i][e]=t,t.row=i,t.col=e,r++}else this.nodes[i][e]=null;this.columnNodes[e].size=r}for(let e=0;e<t.rowNum;e++){let r=null,i=null;for(let s=0;s<t.columnNum;s++){if(null==this.nodes[e][s])continue;let t=this.nodes[e][s];null==i?(i=t,r=t):(t.left=r,r.right=t,r=t)}r.right=i,i.left=r}for(let e=0;e<t.columnNum;e++){let r=null,i=this.columnNodes[e],s=i;for(let l=0;l<t.rowNum;l++)null!=this.nodes[l][e]&&(s=this.nodes[l][e],s.head=i,null==r?(s.up=i,i.down=s):(s.up=r,r.down=s),r=s);s.down=i,i.up=s}}}class o{constructor(t,e,r){this.board=t.board,this.tiles=t.tiles,this.coverArray=e,this.linkArray=r,this.stack=[],this.solution=[],this.result=[],this.level=0,this.endTime=0,this.firstTime=!0,this.solve(this.linkArray,!0)}generateSolution(t){let e=new Array(this.solution.length),r=this.solution.slice(0),i=[];for(let t=0;t<this.board.data.length;t++)i.push(new Array(this.board.data[0].length));for(let t=0;t<i.length;t++)for(let e=0;e<i[0].length;e++)i[t][e]=" ";for(let t=e.length-1;t>=0;t--)e[t]=r.pop();for(const t of e){let e=this.coverArray.coverArray[t.row],r=0;for(let t=0;t<this.tiles.length;t++)if(1==e[t]){r=t;break}let s=this.nextNChar("a",r);for(let t=this.tiles.length;t<e.length;t++)if(1==e[t]){let e=t-this.tiles.length;for(let t=0;t<this.coverArray.boardidx.length;t++)for(let r=0;r<this.coverArray.boardidx[0].length;r++)this.coverArray.boardidx[t][r]==e&&(i[t][r]=s)}}return i}putSolution(t,e){if(e){let e=new i(t),r=e.allDataArrays;for(let t=0;t<this.result.length;t++)for(let i=0;i<r.length;i++)if(e.equalData(this.result[t],r[i]))return}this.result.push(t)}solve(t,e){if(this.level++,t.h.right==t.h||t.h.left.col<t.tileNum){let t=this.generateSolution(this.solution);return void this.putSolution(t,e)}let r=this.findStartColumn(t);this.cover(r);for(let i=r.down;i!=r;i=i.down){this.solution.push(i);for(let t=i.right;t!=i;t=t.right)this.cover(t.head);this.solve(t,e),i=this.solution.pop(),r=i.head;for(let t=i.left;t!=i;t=t.left)this.uncover(t.head)}this.uncover(r),this.level--}cover(t){t.left.right=t.right,t.right.left=t.left;for(let e=t.down;e!=t;e=e.down)for(let t=e.right;t!=e;t=t.right)t.up.down=t.down,t.down.up=t.up,t.head.size--}uncover(t){for(let e=t.up;e!=t;e=e.up)for(let t=e.left;t!=e;t=t.left)t.up.down=t,t.down.up=t,t.head.size++;t.right.left=t,t.left.right=t}findStartColumn(t){let e=t.h,r=Number.MAX_SAFE_INTEGER,i=e,s=e.right,l=this.board.getArea(),h=0;for(let t=0;t<this.tiles.length;t++)h+=this.tiles[t].getArea();for(;s!=e;)h>l&&s.col<this.tiles.length||s.size<r&&(r=s.size,i=s),s=s.right;return i}nextNChar(t,e){return String.fromCharCode(t.charCodeAt(0)+e)}}document.getElementById("tileFile").addEventListener("change",(function(){const t=this.files[0],e=new FileReader;e.onload=t=>{u=t.target.result;let e=new s(u),r=e.getTiles(),i=e.getBoard(),h=new l(r,i,!0,!0),a=new n(h),d=new o(e,h,a);const g=document.getElementById("board"),c=g.getContext("2d");g.width,g.height;console.log(c,i.data),function(t,e){t.strokeStyle="#000000",t.fillStyle="#FF0000";for(let r=0;r<e.data.length;r++)for(let i=0;i<e.data[0].length;i++)t.strokeRect(70+60*i,180+60*r,60,60)," "!=e.data[r][i]&&t.fillRect(70+60*i,180+60*r,60,60)}(c,i),f=d.result,console.log(f)},e.onerror=t=>reject(t),e.readAsText(t)}),!1);var u="",f=null}]);